<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOLDENWAY 官網內容備份</title>

<style>
    body {
        margin: 0;
        display: flex;
        height: 100vh;
        background: #f6f7fb;
        font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", sans-serif;
        color: #333;
    }

    /* 左側：樹狀結構 */
    .sidebar {
        width: 320px;
        background: #ffffffcc;
        backdrop-filter: blur(14px);
        border-right: 1px solid #e5e7eb;
        overflow-y: auto;
        padding: 20px;
    }

    .title {
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 12px;
    }

    /* folder */
    .folder {
        font-weight: 600;
        margin: 8px 0 4px;
        cursor: pointer;
        user-select: none;
    }

    /* file */
    .file {
        padding-left: 16px;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        font-size: 14px;
    }

    .file:hover {
        background: #eef2ff;
    }

    /* 右側 iframe 預覽區（亮色版） */
    .preview {
        flex: 1;
        background: #fff;
    }

    iframe {
        width: 100%;
        height: 100%;
        border: none;
        background: #ffffff;
    }
</style>
</head>

<body>

<div class="sidebar">
    <div class="title">網站檔案索引</div>
    <div id="tree"></div>
</div>

<div class="preview">
    <iframe id="viewer" src=""></iframe>
</div>

<script>
const TREE_URL = "https://raw.githubusercontent.com/TsenWu/goldenway-website-backup/refs/heads/main/tree-data.json";

/* 產生階層式樹狀資料 */
function buildHierarchy(list) {
    const root = {};

    list.forEach(item => {
        const parts = item.path.split("/");
        let current = root;

        parts.forEach((part, idx) => {
            if (!current[part]) {
                current[part] = {
                    __files: [],
                    __folders: {}
                };
            }

            if (idx === parts.length - 1) {
                current[part].__files.push(item.path);
            } else {
                current = current[part].__folders;
            }
        });
    });

    return root;
}

/* 建立 HTML 樹狀 UI */
function renderTree(node, container, basePath = "") {
    Object.keys(node).forEach(key => {
        const item = node[key];

        // folder
        if (item.__folders || item.__files.length > 0) {
            const folderDiv = document.createElement("div");
            folderDiv.className = "folder";
            folderDiv.textContent = key;

            const subContainer = document.createElement("div");
            subContainer.style.paddingLeft = "16px";

            folderDiv.onclick = () => {
                subContainer.style.display =
                    subContainer.style.display === "none" ? "block" : "none";
            };

            container.appendChild(folderDiv);
            container.appendChild(subContainer);

            // files
            item.__files.forEach(filePath => {
                const fileDiv = document.createElement("div");
                fileDiv.className = "file";
                fileDiv.textContent = filePath.split("/").pop();
                fileDiv.onclick = () => {
                    document.getElementById("viewer").src = filePath;
                };
                subContainer.appendChild(fileDiv);
            });

            // folders
            renderTree(item.__folders, subContainer, key + "/");
        }
    });
}

/* 讀取 JSON */
fetch(TREE_URL)
    .then(r => r.json())
    .then(data => {
        const hierarchy = buildHierarchy(data);
        renderTree(hierarchy, document.getElementById("tree"));
    })
    .catch(err => {
        document.getElementById("tree").innerHTML =
            "<p style='color:red'>無法載入 tree-data.json<br>" + err + "</p>";
    });
</script>

</body>
</html>
